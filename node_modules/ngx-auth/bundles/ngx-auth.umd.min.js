!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("rxjs/operator/first"),require("rxjs/operator/switchMap"),require("rxjs/operator/map"),require("rxjs/operator/catch"),require("rxjs/observable/throw"),require("@angular/common/http"),require("rxjs/Subject")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/router","rxjs/operator/first","rxjs/operator/switchMap","rxjs/operator/map","rxjs/operator/catch","rxjs/observable/throw","@angular/common/http","rxjs/Subject"],t):t(e["ngx-auth"]={},e.ng.core,e.ng.router,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable,e.ng.common.http,e.Rx)}(this,function(e,t,r,n,o,i,c,a,u,s){"use strict";function f(e){return n.first.call(e)}function p(e,t){return o.switchMap.call(e,t)}function l(e,t){return i.map.call(e,t)}var h=function(){return function(){}}(),d=new t.InjectionToken("AUTH_SERVICE"),b=new t.InjectionToken("PUBLIC_FALLBACK_PAGE_URI"),g=new t.InjectionToken("PROTECTED_FALLBACK_PAGE_URI"),y=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},j=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};e.PublicGuard=function(){function e(e,t,r){this.authService=e,this.protectedFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return l(this.authService.isAuthorized(),function(e){return!(e&&!r.isProtectedPage(t))||(r.navigate(r.protectedFallbackPageUri),!1)})},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isProtectedPage=function(e){return e.url===this.protectedFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}(),e.PublicGuard=y([t.Injectable(),v(0,t.Inject(d)),v(1,t.Inject(g)),j("design:paramtypes",[h,String,r.Router])],e.PublicGuard);var P=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},R=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};e.ProtectedGuard=function(){function e(e,t,r){this.authService=e,this.publicFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return l(this.authService.isAuthorized(),function(e){return!(!e&&!r.isPublicPage(t))||(r.navigate(r.publicFallbackPageUri),!1)})},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isPublicPage=function(e){return e.url===this.publicFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}(),e.ProtectedGuard=P([t.Injectable(),_(0,t.Inject(d)),_(1,t.Inject(b)),R("design:paramtypes",[h,String,r.Router])],e.ProtectedGuard);var I=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};e.ɵa=function(){function e(e){this.injector=e,this.refreshInProgress=!1,this.refreshSubject=new s.Subject}return e.prototype.intercept=function(e,t){return this.injector.get(d).verifyTokenRequest(e.url)?t.handle(e):this.processIntercept(e,t)},e.prototype.processIntercept=function(e,t){var r=this,n=e.clone();return function(e,t){return c._catch.call(e,t)}(p(this.request(n),function(e){return t.handle(e)}),function(e){return r.responseError(n,e)})},e.prototype.request=function(e){return this.refreshInProgress?this.delayRequest(e):this.addToken(e)},e.prototype.responseError=function(e,t){var r=this,n=this.injector.get(d),o=n.refreshShouldHappen(t);return o&&!this.refreshInProgress&&(this.refreshInProgress=!0,n.refreshToken().subscribe(function(){r.refreshInProgress=!1,r.refreshSubject.next(!0)},function(){r.refreshInProgress=!1,r.refreshSubject.next(!1)})),o&&this.refreshInProgress?this.delayRequest(e,t):a._throw(t)},e.prototype.addToken=function(e){var t=this.injector.get(d);return f(l(t.getAccessToken(),function(r){if(r){var n=void 0;return n="function"==typeof t.getHeaders?t.getHeaders(r):{Authorization:"Bearer "+r},e.clone({setHeaders:n})}return e}))},e.prototype.delayRequest=function(e,t){var r=this.injector.get(u.HttpClient);return p(f(this.refreshSubject),function(n){return n?r.request(e):a._throw(t||e)})},e}(),e.ɵa=I([t.Injectable(),A("design:paramtypes",[t.Injector])],e.ɵa);var m=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c};e.AuthModule=function(){return function(){}}(),e.AuthModule=m([t.NgModule({providers:[e.PublicGuard,e.ProtectedGuard,e.ɵa,{provide:u.HTTP_INTERCEPTORS,useClass:e.ɵa,multi:!0}]})],e.AuthModule),e.AuthService=h,e.AUTH_SERVICE=d,e.PUBLIC_FALLBACK_PAGE_URI=b,e.PROTECTED_FALLBACK_PAGE_URI=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-auth.umd.min.js.map
