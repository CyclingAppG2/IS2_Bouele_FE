{"version":3,"file":"ngx-auth.umd.js","sources":["~/ngx-auth/src/auth.module.ts","~/ngx-auth/src/auth.interceptor.ts","~/ngx-auth/src/protected.guard.ts","~/ngx-auth/src/public.guard.ts","~/ngx-auth/src/tokens.ts","~/ngx-auth/src/rxjs.util.ts","~/ngx-auth/src/auth.service.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { PublicGuard } from './public.guard';\nimport { ProtectedGuard } from './protected.guard';\nimport { AuthInterceptor } from './auth.interceptor';\n\n@NgModule({\n  providers: [\n    PublicGuard,\n    ProtectedGuard,\n    AuthInterceptor,\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: AuthInterceptor,\n      multi: true,\n    }\n  ]\n})\nexport class AuthModule {\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpClient,\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpErrorResponse\n} from '@angular/common/http';\nimport { Subject } from 'rxjs/Subject';\nimport { Observable } from 'rxjs/Observable';\n\nimport {\n  map,\n  first,\n  switchMap,\n  _throw,\n  _catch\n} from './rxjs.util';\n\nimport { AuthService } from './auth.service';\nimport { AUTH_SERVICE } from './tokens';\n\n@Injectable()\nexport class AuthInterceptor implements HttpInterceptor {\n\n  /**\n   * Is refresh token is being executed\n   *\n   * @private\n   *\n   * @type {boolean}\n   */\n  private refreshInProgress = false;\n\n  /**\n   * Notify all outstanding requests through this subject\n   *\n   * @private\n   *\n   * @type {Subject<boolean>}\n   */\n  private refreshSubject: Subject<boolean> = new Subject<boolean>();\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Intercept an outgoing `HttpRequest`\n   *\n   * @param {HttpRequest<*>} req\n   * @param {HttpHandler} delegate\n   *\n   * @returns {Observable<HttpEvent<*>>}\n   */\n  public intercept(\n    req: HttpRequest<any>,\n    delegate: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const authService: AuthService =\n      this.injector.get<AuthService>(AUTH_SERVICE);\n\n    if (authService.verifyTokenRequest(req.url)) {\n      return delegate.handle(req);\n    }\n\n    return this.processIntercept(req, delegate);\n  }\n\n  /**\n   * Process all the requests via custom interceptors.\n   *\n   * @private\n   *\n   * @param {HttpRequest<*>} original\n   * @param {HttpHandler} delegate\n   *\n   * @returns {Observable<HttpEvent<*>>}\n   */\n  private processIntercept(\n    original: HttpRequest<any>,\n    delegate: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const clone: HttpRequest<any> = original.clone();\n\n    return _catch(\n      switchMap(\n        this.request(clone),\n        (req: HttpRequest<any>) => delegate.handle(req)\n      ),\n      (res: HttpErrorResponse) => this.responseError(clone, res)\n    );\n  }\n\n  /**\n   * Request interceptor. Delays request if refresh is in progress\n   * otherwise adds token to the headers\n   *\n   * @private\n   *\n   * @param {HttpRequest<*>} req\n   *\n   * @returns {Observable}\n   */\n  private request(req: HttpRequest<any>): Observable<HttpRequest<any>|HttpEvent<any>> {\n    if (this.refreshInProgress) {\n      return this.delayRequest(req);\n    }\n\n    return this.addToken(req);\n  }\n\n  /**\n   * Failed request interceptor, check if it has to be processed with refresh\n   *\n   * @private\n   *\n   * @param {HttpRequest<*>} req\n   * @param {HttpErrorResponse} res\n   *\n   * @returns {Observable<HttpRequest<*>>}\n   */\n  private responseError(\n    req: HttpRequest<any>,\n    res: HttpErrorResponse\n  ): Observable<HttpEvent<any>> {\n    const authService: AuthService =\n      this.injector.get<AuthService>(AUTH_SERVICE);\n    const refreshShouldHappen: boolean =\n      authService.refreshShouldHappen(res);\n\n    if (refreshShouldHappen && !this.refreshInProgress) {\n      this.refreshInProgress = true;\n\n      authService\n        .refreshToken()\n        .subscribe(\n          () => {\n            this.refreshInProgress = false;\n            this.refreshSubject.next(true);\n          },\n          () => {\n            this.refreshInProgress = false;\n            this.refreshSubject.next(false)\n          }\n        );\n    }\n\n    if (refreshShouldHappen && this.refreshInProgress) {\n      return this.delayRequest(req, res);\n    }\n\n    return _throw(res);\n  }\n\n  /**\n   * Add access token to headers or the request\n   *\n   * @private\n   *\n   * @param {HttpRequest<*>} req\n   *\n   * @returns {Observable<HttpRequest<*>>}\n   */\n  private addToken(req: HttpRequest<any>): Observable<HttpRequest<any>> {\n    const authService: AuthService =\n      this.injector.get<AuthService>(AUTH_SERVICE);\n\n    return first(map(\n      authService.getAccessToken(),\n      (token: string) => {\n        if (token) {\n          let headers : { [name: string]: string | string[] };\n          if(typeof authService.getHeaders === 'function') {\n            headers = authService.getHeaders(token);\n          } else {\n            headers = { Authorization: `Bearer ${token}` };\n          }\n\n          return req.clone({\n            setHeaders: headers\n          });\n        }\n\n        return req;\n      }\n    ));\n  }\n\n  /**\n   * Delay request, by subscribing on refresh event, once it finished, process it\n   * otherwise throw error\n   *\n   * @private\n   *\n   * @param {HttpRequest<*>} req\n   * @param {HttpErrorResponse} [res]\n   *\n   * @returns {Observable<HttpRequest<*>>}\n   */\n  private delayRequest(\n    req: HttpRequest<any>,\n    res?: HttpErrorResponse\n  ): Observable<HttpEvent<any>> {\n    const http: HttpClient =\n      this.injector.get<HttpClient>(HttpClient);\n\n    return switchMap(\n      first(this.refreshSubject),\n      (status: boolean) => {\n        if (status) {\n          return http.request(req)\n        }\n\n        return _throw(res || req)\n      }\n    );\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport {\n  Router,\n  CanActivate,\n  CanActivateChild,\n  ActivatedRouteSnapshot,\n  RouterStateSnapshot\n} from '@angular/router';\nimport { Observable } from 'rxjs/Observable';\n\nimport { map } from './rxjs.util';\n\nimport { AuthService } from './auth.service';\nimport { AUTH_SERVICE, PUBLIC_FALLBACK_PAGE_URI } from './tokens';\n\n/**\n * Guard, checks access token availability and allows or disallows access to page,\n * and redirects out\n *\n * usage: { path: 'test', component: TestComponent, canActivate: [ AuthGuard ] }\n *\n * @export\n *\n * @class ProtectedGuard\n *\n * @implements {CanActivate}\n * @implements {CanActivateChild}\n */\n@Injectable()\nexport class ProtectedGuard implements CanActivate, CanActivateChild {\n\n  constructor(\n    @Inject(AUTH_SERVICE)private authService: AuthService,\n    @Inject(PUBLIC_FALLBACK_PAGE_URI) private publicFallbackPageUri: string,\n    private router: Router\n  ) {}\n\n  /**\n   * CanActivate handler\n   *\n   * @param {ActivatedRouteSnapshot} _route\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {Observable<boolean>}\n   */\n  public canActivate(\n    _route: ActivatedRouteSnapshot,\n    state: RouterStateSnapshot\n  ): Observable<boolean> {\n    return map(\n      this.authService .isAuthorized(),\n      (isAuthorized: boolean) => {\n\n        if (!isAuthorized && !this.isPublicPage(state)) {\n          this.navigate(this.publicFallbackPageUri);\n\n          return false;\n        }\n\n        return true;\n      }\n    );\n  }\n\n  /**\n   * CanActivateChild handler\n   *\n   * @param {ActivatedRouteSnapshot} route\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {Observable<boolean>}\n   */\n  public canActivateChild(\n    route: ActivatedRouteSnapshot,\n    state: RouterStateSnapshot\n  ): Observable<boolean> {\n    return this.canActivate(route, state);\n  }\n\n  /**\n   * Check, if current page is public fallback page\n   *\n   * @private\n   *\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {boolean}\n   */\n  private isPublicPage(state: RouterStateSnapshot): boolean {\n    return state.url === this.publicFallbackPageUri;\n  }\n\n  /**\n   * Navigate away from the app / path\n   *\n   * @private\n   * @param {string} url\n   */\n  private navigate(url: string): void {\n    if (url.startsWith('http')) {\n      window.location.href = url;\n    } else {\n      this.router.navigateByUrl(url);\n    }\n  }\n\n}\n","import { Injectable, Inject } from '@angular/core';\nimport {\n  CanActivate,\n  CanActivateChild,\n  Router,\n  ActivatedRouteSnapshot,\n  RouterStateSnapshot\n} from '@angular/router';\nimport { Observable } from 'rxjs/Observable';\n\nimport { map } from './rxjs.util';\n\nimport { AuthService } from './auth.service';\nimport { AUTH_SERVICE, PROTECTED_FALLBACK_PAGE_URI } from './tokens';\n\n/**\n * Guard, checks access token availability and allows or disallows access to page,\n * and redirects out\n *\n * usage: { path: 'test', component: TestComponent, canActivate: [ PublicGuard ] }\n *\n * @export\n *\n * @class PublicGuard\n *\n * @implements {CanActivate}\n * @implements {CanActivateChild}\n */\n@Injectable()\nexport class PublicGuard implements CanActivate, CanActivateChild {\n\n  constructor(\n    @Inject(AUTH_SERVICE) private authService: AuthService,\n    @Inject(PROTECTED_FALLBACK_PAGE_URI) private protectedFallbackPageUri: string,\n    private router: Router\n  ) {}\n\n  /**\n   * CanActivate handler\n   *\n   * @param {ActivatedRouteSnapshot} _route\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {Observable<boolean>}\n   */\n  public canActivate(\n    _route: ActivatedRouteSnapshot,\n    state: RouterStateSnapshot\n  ): Observable<boolean> {\n    return map(\n      this.authService.isAuthorized(),\n      (isAuthorized: boolean) => {\n\n        if (isAuthorized && !this.isProtectedPage(state)) {\n          this.navigate(this.protectedFallbackPageUri);\n\n          return false;\n        }\n\n        return true;\n      }\n    );\n  }\n\n  /**\n   * CanActivateChild handler\n   *\n   * @param {ActivatedRouteSnapshot} route\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {Observable<boolean>}\n   */\n  public canActivateChild(\n    route: ActivatedRouteSnapshot,\n    state: RouterStateSnapshot\n  ): Observable<boolean> {\n    return this.canActivate(route, state);\n  }\n\n  /**\n   * Check, if current page is protected fallback page\n   *\n   * @private\n   *\n   * @param {RouterStateSnapshot} state\n   *\n   * @returns {boolean}\n   */\n  private isProtectedPage(state: RouterStateSnapshot): boolean {\n    return state.url === this.protectedFallbackPageUri;\n  }\n\n  /**\n   * Navigate away from the app / path\n   *\n   * @private\n   * @param {string} url\n   */\n  private navigate(url: string): void {\n    if (url.startsWith('http')) {\n      window.location.href = url;\n    } else {\n      this.router.navigateByUrl(url);\n    }\n  }\n\n}\n","import { InjectionToken } from '@angular/core';\n\nexport const AUTH_SERVICE = new InjectionToken('AUTH_SERVICE');\nexport const PUBLIC_FALLBACK_PAGE_URI = new InjectionToken('PUBLIC_FALLBACK_PAGE_URI');\nexport const PROTECTED_FALLBACK_PAGE_URI = new InjectionToken('PROTECTED_FALLBACK_PAGE_URI');\n","import { Observable } from 'rxjs/Observable';\nimport { first as _first } from 'rxjs/operator/first';\nimport { switchMap as _switchMap } from 'rxjs/operator/switchMap';\nimport { map as _map } from 'rxjs/operator/map';\nimport { _catch as __catch } from 'rxjs/operator/catch';\n\nexport function first<T>(obs: Observable<T>): Observable<T> {\n  return _first.call(obs);\n}\n\nexport function switchMap<T, R>(\n  obs: Observable<T>,\n  project: (value: T, index: number) => Observable<R>\n): Observable<R> {\n  return _switchMap.call(obs, project);\n}\n\nexport function map<T, R>(\n  obs: Observable<T>,\n  project: (value: T, index: number) => R\n): Observable<R> {\n  return _map.call(obs, project);\n}\n\nexport function _catch<T, R>(\n  obs: Observable<T>,\n  selector: (err: any, caught: Observable<T>) => Observable<R>\n): Observable<T | R> {\n  return __catch.call(obs, selector);\n}\n\nexport { _throw } from 'rxjs/observable/throw';\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { Observable } from 'rxjs/Observable';\n\n/**\n * Essential service for authentication\n * @export\n * @interface AuthService\n */\nexport abstract class AuthService {\n\n  /**\n   * Check, if user already authorized.\n   *\n   * Should return Observable with true or false values\n   *\n   * @public\n   *\n   * @returns {Observable<boolean>}\n   */\n  public abstract isAuthorized(): Observable<boolean>;\n\n  /**\n   * Get access token\n   *\n   * Should return access token in Observable from e.g.\n   * localStorage\n   *\n   * @public\n   *\n   * @returns {Observable<string>}\n   */\n  public abstract getAccessToken(): Observable<string>;\n\n  /**\n   * Function, that should perform refresh token verifyTokenRequest\n   *\n   * Should be successfully completed so interceptor\n   * can execute pending requests or retry original one\n   *\n   * @public\n   *\n   * @returns {Observable<*>}\n   */\n  public abstract refreshToken(): Observable<any>;\n\n  /**\n   * Function, checks response of failed request to determine,\n   * whether token be refreshed or not.\n   *\n   * Essentially checks status\n   *\n   * @public\n   *\n   * @param {HttpErrorResponse} response\n   *\n   * @returns {Observable<boolean>}\n   */\n  public abstract refreshShouldHappen(response: HttpErrorResponse): boolean;\n\n  /**\n   * Verify that outgoing request is refresh-token,\n   * so interceptor won't intercept this request\n   *\n   * @public\n   *\n   * @param {string} url\n   *\n   * @returns {Observable<boolean>}\n   */\n  public abstract verifyTokenRequest(url: string): boolean;\n\n\n  /**\n   * Add token to headers, dependent on server\n   * set-up, by default adds a bearer token.\n   * Called by interceptor.\n   *\n   * To change behavior, override this method.\n   *\n   * @public\n   *\n   * @param {string} token\n   *\n   * @returns {[name: string]: string | string[]}\n   */\n  public abstract getHeaders?(token: string) : { [name: string]: string | string[] };\n}\n"],"names":["AuthModule","AuthInterceptor","HTTP_INTERCEPTORS","ProtectedGuard","PublicGuard","NgModule","__decorate","__metadata","Injector","Injectable","_throw","http","switchMap","first","HttpClient","map","_catch","Subject","Router","__param","Inject","router","InjectionToken","__catch","_map","_switchMap","_first"],"mappings":"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"}
